計画（PLAN）ファイルをレビューし、プロジェクトの原則・現行実装との整合性を検証します。

引数: `$ARGUMENTS` — レビュー対象の計画ファイルパス（例: `~/.claude/plans/drifting-petting-matsumoto.md`）

---

## Phase 0: 全ての前提
- 破壊的変更を厭わないでください。マイグレーションも不要です。DRY原則と単一責任の原則を最優先して、コードをシンプルに保ち、品質に拘って。この前提で考えて進めてください。
- 実装者はこのレビューをもとにコードを書きます。実装者がこのレビューを読んで、計画の内容を理解し、指摘された問題点を修正してから実装に入ることになります。

## Phase 1: 計画の読み込みと理解

1. `$ARGUMENTS` で指定された計画ファイルを読む
2. 計画の**目的**・**変更ファイル一覧**・**新規追加される型/関数/コンポーネント**を抽出する
3. 計画の概要を1〜2文でまとめ、以降のレビューの前提とする

## Phase 2: プロジェクト原則との照合

CLAUDE.md の以下の原則に違反していないか検証する:

- **Principles**: 破壊的変更可・マイグレーション不要・DRY/SRP最優先・品質重視
- **Code Style**: ESMのみ、interface優先、import順序、命名規則
- **プロジェクトパターン**: Zustand経由のデータフロー（components → stores → lib）、Worker境界（入力=ArrayBuffer、出力=JSON serializable）、ディレクトリ配置規約
- **Do NOT リスト**: any禁止、console.log禁止、innerHTML禁止、ROADMAP外の機能追加禁止 等
- **Testing**: 新規lib/モジュールにテスト計画が含まれているか

## Phase 3: 現行実装とのフル照合

計画に登場する**すべてのファイル・関数・型・ストア**について、実コードと突合する。Explore subagent を活用して並列に調査すること。

確認観点:
- 計画で「既存」として参照されるファイル・関数・型が**実際に存在するか**
- 既存の関数シグネチャ・型定義と計画の想定が**一致するか**（引数の型、戻り値、プロパティ名）
- ストアのstate構造・アクション名が現行実装と**整合しているか**
- 計画で変更対象のファイルが他機能から参照されている場合、**影響範囲が考慮されているか**
- 計画で削除・置換対象のコードが、テストで参照されていないか

## Phase 4: 技術的実現可能性の検証

- 提案されたAPIやライブラリの使い方が**実際の仕様と合致するか**（例: TextDecoderの挙動、React APIの引数）
- 非同期処理・Worker間通信のフローに**デッドロックや競合の可能性がないか**
- パフォーマンス上の懸念（不要な再レンダリング、大量データの同期処理等）がないか

## Phase 5: レビュー結果の出力

以下の3段階の優先度で問題点を分類し、**優先度順リスト**として出力する:

### 出力フォーマット

```
## 🔴 Critical — 実装前に必ず修正が必要
1. [問題の要約]
   - 根拠: [該当ファイル:行番号 or 原則の引用]
   - 提案: [修正案]

## 🟡 Warning — 実装可能だが改善推奨
1. [問題の要約]
   - 根拠: [該当ファイル:行番号 or 原則の引用]
   - 提案: [修正案]

## 🟢 Info — 軽微な指摘・提案
1. [問題の要約]
   - 根拠: [該当ファイル:行番号 or 原則の引用]
   - 提案: [修正案]

## ✅ 良い点
- [計画の優れた点や妥当な設計判断]
```

### 分類基準

- **Critical**: 実装すると壊れる（存在しない関数/型の参照、シグネチャ不一致、アーキテクチャ違反）
- **Warning**: 実装は可能だが原則違反や保守性の問題がある（DRY違反、責務の混在、テスト漏れ）
- **Info**: 命名規則のずれ、より良い代替手段の存在、ドキュメントとの微小な不整合

## Phase 6: クリップボードにレビュー結果をコピーするため、最後に以下のコマンドを実行してください。

```
pbcopy echo "[レビュー結果]"
```

---

**重要**: 根拠のない指摘は行わない。すべての指摘に対して、参照したファイルパス・行番号・原則の該当箇所を明示すること。
